<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#038cfc" />
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>–ö–∞–ª–æ—Ä–∏–∏ ‚Äî PWA</title>
  <link rel="stylesheet" href="styles.css?v=2">
</head>
<body>
  <header class="app-header">
    <h1>–ö–∞–ª–æ—Ä–∏–∏</h1>
    <button id="themeToggle" title="–¢—ë–º–Ω–∞—è —Ç–µ–º–∞">üåì</button>
  </header>

  <main id="view"></main>

  <nav class="tabs">
    <button data-tab="today" class="active">–°–µ–≥–æ–¥–Ω—è</button>
    <button data-tab="library">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</button>
    <button data-tab="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    <button data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </nav>

  <template id="tpl-today">
    <section class="section">
      <h2>–ò—Ç–æ–≥ –∑–∞ –¥–µ–Ω—å</h2>
      <div class="summary">
        <div class="sum-item"><div class="sum-value" id="sumKcal">0</div><div class="sum-label">–ö–∫–∞–ª</div></div>
        <div class="sum-item"><div class="sum-value" id="sumProt">0</div><div class="sum-label">–ë–µ–ª–∫–∏</div></div>
        <div class="sum-item"><div class="sum-value" id="sumFat">0</div><div class="sum-label">–ñ–∏—Ä—ã</div></div>
        <div class="sum-item"><div class="sum-value" id="sumCarb">0</div><div class="sum-label">–£–≥–ª–µ–≤.</div></div>
      </div>
      <div class="actions">
        <button id="addFromLibraryBtn">–î–æ–±–∞–≤–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</button>
        <button id="addManualBtn">–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</button>
      </div>
      <ul id="entriesList" class="list"></ul>
    </section>
  </template>

  <template id="tpl-library">
    <section class="section">
      <div class="row">
        <input id="libSearch" placeholder="–ü–æ–∏—Å–∫..." />
        <button id="libAddBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button id="libImportBtn">–ò–º–ø–æ—Ä—Ç CSV</button>
        <button id="libExportBtn">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
        <input id="libImportFile" type="file" accept=".csv" style="display:none" />
      </div>
      <ul id="libList" class="list"></ul>
    </section>
  </template>

  <template id="tpl-stats">
    <section class="section">
      <div class="row wrap">
        <label>–°: <input type="date" id="statFrom" /></label>
        <label>–ü–æ: <input type="date" id="statTo" /></label>
        <label><input type="checkbox" id="showKcal" checked /> –ö–∫–∞–ª</label>
        <label><input type="checkbox" id="showProt" checked /> –ë–µ–ª–∫–∏</label>
        <label><input type="checkbox" id="showFat" checked /> –ñ–∏—Ä—ã</label>
        <label><input type="checkbox" id="showCarb" checked /> –£–≥–ª–µ–≤–æ–¥—ã</label>
      </div>
      <div class="row">
        <button data-preset="7">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</button>
        <button data-preset="30">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</button>
        <button data-preset="m0">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</button>
        <button data-preset="m1">–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</button>
        <label style="margin-left:auto"><input type="checkbox" id="showValuesToggle" /> –ü–æ–¥–ø–∏—Å–∏ –∑–Ω–∞—á–µ–Ω–∏–π</label>
      </div>
      <div class="legend">
        <span class="dot kcal"></span>–ö–∫–∞–ª
        <span class="dot prot"></span>–ë–µ–ª–∫–∏
        <span class="dot fat"></span>–ñ–∏—Ä—ã
        <span class="dot carb"></span>–£–≥–ª–µ–≤–æ–¥—ã
      </div>
      <canvas id="chart" width="600" height="260" aria-label="–ì—Ä–∞—Ñ–∏–∫ –ö–ë–ñ–£"></canvas>
      <table class="table" id="statTable">
        <thead><tr><th>–î–∞—Ç–∞</th><th>–∫</th><th>–±</th><th>–∂</th><th>—É</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </template>

  <template id="tpl-settings">
    <section class="section">
      <h3>–¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞ –¥–µ–Ω—å)</h3>
      <div class="grid2">
        <label>–ö–∞–ª–æ—Ä–∏–∏: <input type="number" id="goalKcal" min="0" step="50" /></label>
        <label>–ë–µ–ª–∫–∏ (–≥): <input type="number" id="goalProt" min="0" /></label>
        <label>–ñ–∏—Ä—ã (–≥): <input type="number" id="goalFat" min="0" /></label>
        <label>–£–≥–ª–µ–≤–æ–¥—ã (–≥): <input type="number" id="goalCarb" min="0" /></label>
      </div>
      <p class="hint">–ö–∫–∞–ª = –ë√ó4 + –ñ√ó9 + –£√ó4 (–µ—Å–ª–∏ –ø–æ–ª–µ –∫–∞–ª–æ—Ä–∏–π –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –ø–æ—Å—á–∏—Ç–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</p>

      <h3>–ù–∞—á–∞–ª–æ –¥–Ω—è</h3>
      <label>–ß–∞—Å –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–≥–æ –¥–Ω—è: <input type="number" id="dayStartHour" min="0" max="23" /></label>

      <h3>–¢–µ–º–∞</h3>
      <label><input type="checkbox" id="darkTheme" /> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</label>

      <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
      <label><input type="checkbox" id="specRecs" /> –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–æ–∑–∂–µ)</label>

      <h3>–ò—Å—Ç–æ—Ä–∏—è –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h3>
      <div class="row wrap">
        <button id="exportHistoryBtn">–≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ CSV</button>
        <button id="exportLibraryBtn">–≠–∫—Å–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ CSV</button>
      </div>
    </section>
  </template>

  <!-- –î–∏–∞–ª–æ–≥–∏ -->
  <dialog id="dlgManual">
    <form method="dialog" class="dialog">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</h3>
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ <input id="mName" required /></label>
      <label>–í–µ—Å (–≥) <input id="mWeight" type="number" min="0" step="1" required /></label>
      <div class="grid2">
        <label>–ö–∫–∞–ª / 100–≥ <input id="mKcal100" type="number" min="0" step="1" required /></label>
        <label>–ë–µ–ª–∫–∏ / 100–≥ <input id="mProt100" type="number" min="0" step="0.1" required /></label>
        <label>–ñ–∏—Ä—ã / 100–≥ <input id="mFat100" type="number" min="0" step="0.1" required /></label>
        <label>–£–≥–ª–µ–≤–æ–¥—ã / 100–≥ <input id="mCarb100" type="number" min="0" step="0.1" required /></label>
      </div>
      <menu>
        <button value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="mSaveBtn" value="default">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgLibAdd">
    <form method="dialog" class="dialog">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</h3>
      <div id="libSelName" class="mb8"></div>
      <label>–í–µ—Å (–≥) <input id="libSelWeight" type="number" min="0" step="1" required /></label>
      <menu>
        <button value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="libSelSave" value="default">–î–æ–±–∞–≤–∏—Ç—å</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlgCsvPreview">
    <form method="dialog" class="dialog">
      <h3>–ò–º–ø–æ—Ä—Ç CSV ‚Äî –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
      <p class="hint">–û—à–∏–±–æ—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã. –ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ.</p>
      <div class="scroll">
        <table class="table" id="csvPreviewTable">
          <thead><tr><th>#</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ö–∫–∞–ª</th><th>–ë–µ–ª–∫–∏</th><th>–ñ–∏—Ä—ã</th><th>–£–≥–ª–µ–≤–æ–¥—ã</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <menu>
        <button value="cancel">–û—Ç–º–µ–Ω–∞</button>
        <button id="csvConfirmBtn" value="default">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      </menu>
    </form>
  </dialog>

  <script src="app.js?v=2"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
    }
  </script>
</body>
</html>
